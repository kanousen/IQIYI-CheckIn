name: 爱奇艺会员签到

on:
    workflow_dispatch:
    schedule:
        - cron: "0 21,12 * * *"
    watch:
        types: [started]

jobs:
    build:
        runs-on: ubuntu-latest
        if: github.event.repository.owner.id == github.event.sender.id || ! github.event.sender.id || github.actor == 'BlueSkyClouds'
        timeout-minutes: 5
        env:
            iQIYI_COOKIE: ${{ secrets.iQIYI_COOKIE }}
            SEND_KEY: ${{ secrets.SEND_KEY }}
            PUSH_KEY: ${{ secrets.PUSH_KEY }}
            BARK_PUSH: ${{ secrets.BARK_PUSH }}
            PUSH_PLUS_TOKEN: ${{ secrets.PUSH_PLUS_TOKEN}}
            PUSH_PLUS_USER: ${{ secrets.PUSH_PLUS_USER}}
            QYWX_KEY: ${{ secrets.QYWX_KEY}}
            QYWX_AM: ${{ secrets.QYWX_AM}}
            TG_PROXY_HOST: ${{ secrets.TG_PROXY_HOST}}
            TG_PROXY_PORT: ${{ secrets.TG_PROXY_PORT}}
            IGOT_PUSH_KEY: ${{ secrets.IGOT_PUSH_KEY}}
            TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
            TG_USER_ID: ${{ secrets.TG_USER_ID }}
            BARK_SOUND: ${{ secrets.BARK_SOUND }}
            DD_BOT_TOKEN: ${{ secrets.DD_BOT_TOKEN }}
            DD_BOT_SECRET: ${{ secrets.DD_BOT_SECRET }}
        
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Cache dependencies
              uses: actions/cache@v2
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-node-

            - name: Use Node.js 16
              uses: actions/setup-node@v3
              with:
                  node-version: 16

            - name: Install dependencies
              run: npm install

            - name: Run iQIYI Daily Bonus
              run: node function/iQIYI-DailyBonus/iqiyi.js